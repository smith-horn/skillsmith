---
/**
 * Skillsmith Contact Page
 * Contact form and support information
 */
import BaseLayout from '../layouts/BaseLayout.astro';

// Get query params for pre-selecting topic
const url = Astro.url;
const plan = url.searchParams.get('plan') || url.searchParams.get('tier');
---

<BaseLayout title="Contact Us | Skillsmith" description="Get in touch with the Skillsmith team. Contact us for support, sales inquiries, or partnership opportunities.">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-white mb-4">Contact Us</h1>
      <p class="text-dark-300 text-lg max-w-2xl mx-auto">
        Have questions about Skillsmith? We're here to help. Reach out to our team
        and we'll get back to you as soon as possible.
      </p>
    </div>

    <div class="grid lg:grid-cols-3 gap-12">
      <!-- Contact Form -->
      <div class="lg:col-span-2">
        <div class="bg-dark-900 border border-dark-700 rounded-xl p-8">
          <h2 class="text-xl font-semibold text-white mb-6">Send us a message</h2>

          <form id="contact-form" class="space-y-6">
            <!-- Name and Email Row -->
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label for="name" class="block text-sm font-medium text-dark-300 mb-2">
                  Name <span class="text-red-400">*</span>
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-4 py-3 bg-dark-800 border border-dark-600 rounded-lg text-white placeholder-dark-500 focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition-colors"
                  placeholder="Your name"
                />
              </div>
              <div>
                <label for="email" class="block text-sm font-medium text-dark-300 mb-2">
                  Email <span class="text-red-400">*</span>
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-4 py-3 bg-dark-800 border border-dark-600 rounded-lg text-white placeholder-dark-500 focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition-colors"
                  placeholder="you@example.com"
                />
              </div>
            </div>

            <!-- Company (Optional) -->
            <div>
              <label for="company" class="block text-sm font-medium text-dark-300 mb-2">
                Company <span class="text-dark-500">(optional)</span>
              </label>
              <input
                type="text"
                id="company"
                name="company"
                class="w-full px-4 py-3 bg-dark-800 border border-dark-600 rounded-lg text-white placeholder-dark-500 focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition-colors"
                placeholder="Your company"
              />
            </div>

            <!-- Topic -->
            <div>
              <label for="topic" class="block text-sm font-medium text-dark-300 mb-2">
                Topic <span class="text-red-400">*</span>
              </label>
              <select
                id="topic"
                name="topic"
                required
                class="w-full px-4 py-3 bg-dark-800 border border-dark-600 rounded-lg text-white focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition-colors"
              >
                <option value="" class="bg-dark-800">Select a topic</option>
                <option value="general" class="bg-dark-800">General Inquiry</option>
                <option value="support" class="bg-dark-800">Technical Support</option>
                <option value="verification" class="bg-dark-800">Skill Verification Request</option>
                <option value="security" class="bg-dark-800">Security Report</option>
                <option value="sales" class="bg-dark-800">Sales / Pricing</option>
                <option value="enterprise" class="bg-dark-800" selected={plan === 'enterprise'}>Enterprise Plans</option>
                <option value="partnership" class="bg-dark-800">Partnership Opportunity</option>
                <option value="feedback" class="bg-dark-800">Product Feedback</option>
                <option value="bug" class="bg-dark-800">Bug Report</option>
                <option value="other" class="bg-dark-800">Other</option>
              </select>
            </div>

            <!-- Message -->
            <div>
              <label for="message" class="block text-sm font-medium text-dark-300 mb-2">
                Message <span class="text-red-400">*</span>
              </label>
              <textarea
                id="message"
                name="message"
                required
                rows="5"
                class="w-full px-4 py-3 bg-dark-800 border border-dark-600 rounded-lg text-white placeholder-dark-500 focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition-colors resize-none"
                placeholder="How can we help you?"
              ></textarea>
            </div>

            <!-- Submit Button -->
            <div>
              <button
                type="submit"
                class="w-full md:w-auto px-8 py-3 gradient-coral text-white font-semibold rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-[#E07A5F] focus:ring-offset-2 focus:ring-offset-dark-900 transition-all"
              >
                Send Message
              </button>
            </div>

            <!-- Form Status -->
            <div id="form-status" class="hidden">
              <div id="form-success" class="hidden p-4 bg-green-900/30 border border-green-700/50 rounded-lg">
                <p class="text-green-400 flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                  Thank you! Your message has been sent. We'll get back to you soon.
                </p>
              </div>
              <div id="form-error" class="hidden p-4 bg-red-900/30 border border-red-700/50 rounded-lg">
                <p class="text-red-400 flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                  Something went wrong. Please try again or email us directly.
                </p>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Contact Info Sidebar -->
      <div class="space-y-6">
        <!-- How We Can Help -->
        <div class="bg-dark-900 border border-dark-700 rounded-xl p-6">
          <h3 class="text-lg font-semibold text-white mb-4">How We Can Help</h3>

          <div class="space-y-4">
            <!-- General -->
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-primary-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <p class="text-sm font-medium text-white">General Questions</p>
                <p class="text-sm text-dark-400">Product info, pricing, features</p>
              </div>
            </div>

            <!-- Support -->
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
              </div>
              <div>
                <p class="text-sm font-medium text-white">Technical Support</p>
                <p class="text-sm text-dark-400">Installation, configuration, bugs</p>
              </div>
            </div>

            <!-- Verification -->
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
              </div>
              <div>
                <p class="text-sm font-medium text-white">Skill Verification</p>
                <p class="text-sm text-dark-400">Get your skill verified</p>
              </div>
            </div>

            <!-- Enterprise -->
            <div class="flex items-start gap-3">
              <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
              </div>
              <div>
                <p class="text-sm font-medium text-white">Enterprise Sales</p>
                <p class="text-sm text-dark-400">Custom plans, SLAs, on-premise</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Response Time -->
        <div class="bg-dark-900 border border-dark-700 rounded-xl p-6">
          <h3 class="text-lg font-semibold text-white mb-4">Response Time</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <span class="text-dark-400">General inquiries</span>
              <span class="text-white">1-2 business days</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-dark-400">Technical support</span>
              <span class="text-white">24-48 hours</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-dark-400">Enterprise</span>
              <span class="text-green-400">Priority response</span>
            </div>
          </div>
        </div>

        <!-- Social Links -->
        <div class="bg-dark-900 border border-dark-700 rounded-xl p-6">
          <h3 class="text-lg font-semibold text-white mb-4">Connect With Us</h3>
          <div class="flex gap-4">
            <a
              href="https://github.com/smith-horn/skillsmith"
              target="_blank"
              rel="noopener noreferrer"
              class="w-10 h-10 bg-dark-800 rounded-lg flex items-center justify-center text-dark-400 hover:text-white hover:bg-dark-700 transition-colors"
              aria-label="GitHub"
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.115 2.504.337 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z" />
              </svg>
            </a>
          </div>
        </div>

        <!-- Company Info -->
        <div class="bg-dark-900 border border-dark-700 rounded-xl p-6">
          <h3 class="text-lg font-semibold text-white mb-4">Company</h3>
          <p class="text-dark-300 text-sm">
            <strong class="text-white">Smith Horn Group Ltd.</strong><br />
            Vancouver, British Columbia<br />
            Canada
          </p>
        </div>
      </div>
    </div>

    <!-- FAQ Section -->
    <div class="mt-16">
      <h2 class="text-2xl font-bold text-white mb-8 text-center">Frequently Asked Questions</h2>

      <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto">
        <div class="bg-dark-900 border border-dark-700 rounded-lg p-6">
          <h3 class="font-semibold text-white mb-2">How do I report a bug?</h3>
          <p class="text-dark-400 text-sm">
            You can report bugs through this contact form (select "Bug Report"), or open an issue
            directly on our <a href="https://github.com/smith-horn/skillsmith/issues" class="text-primary-400 hover:text-primary-300 underline decoration-primary-400/50 hover:decoration-primary-300">GitHub repository</a>.
          </p>
        </div>

        <div class="bg-dark-900 border border-dark-700 rounded-lg p-6">
          <h3 class="font-semibold text-white mb-2">Do you offer custom Enterprise plans?</h3>
          <p class="text-dark-400 text-sm">
            Yes! Contact our Enterprise team to discuss custom pricing, SLAs, dedicated support,
            and on-premise deployment options.
          </p>
        </div>

        <div class="bg-dark-900 border border-dark-700 rounded-lg p-6">
          <h3 class="font-semibold text-white mb-2">Where can I find documentation?</h3>
          <p class="text-dark-400 text-sm">
            Visit our <a href="/docs" class="text-primary-400 hover:text-primary-300 underline decoration-primary-400/50 hover:decoration-primary-300">documentation</a> for
            guides, API references, and tutorials on using Skillsmith.
          </p>
        </div>

        <div class="bg-dark-900 border border-dark-700 rounded-lg p-6">
          <h3 class="font-semibold text-white mb-2">Can I request a new feature?</h3>
          <p class="text-dark-400 text-sm">
            Absolutely! Use this form with "Product Feedback" selected, or create a feature request
            on our GitHub discussions page.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    const API_BASE = 'https://api.skillsmith.app/functions/v1';

    // Handle form submission
    document.getElementById('contact-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const form = this;
      const statusDiv = document.getElementById('form-status');
      const successDiv = document.getElementById('form-success');
      const errorDiv = document.getElementById('form-error');
      const submitBtn = form.querySelector('button[type="submit"]');

      // Show loading state
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      // Collect form data
      const formData = {
        name: form.name.value,
        email: form.email.value,
        company: form.company.value || undefined,
        topic: form.topic.value,
        message: form.message.value,
      };

      try {
        const response = await fetch(`${API_BASE}/contact-submit`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        });

        const result = await response.json();

        if (response.ok && result.success) {
          // GA4: Track successful contact form submission (SMI-2463)
          if (typeof window.gtag === 'function') {
            window.gtag('event', 'generate_lead', {
              event_category: 'contact',
              contact_topic: formData.topic,
              has_company: !!formData.company,
            });
          }

          // Show success
          statusDiv.classList.remove('hidden');
          successDiv.classList.remove('hidden');
          errorDiv.classList.add('hidden');
          form.reset();

          // Hide success message after 5 seconds
          setTimeout(() => {
            statusDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
          }, 5000);
        } else {
          throw new Error(result.error || 'Failed to send message');
        }
      } catch (err) {
        console.error('Contact form error:', err);
        statusDiv.classList.remove('hidden');
        successDiv.classList.add('hidden');
        errorDiv.classList.remove('hidden');

        // Hide error after 5 seconds
        setTimeout(() => {
          statusDiv.classList.add('hidden');
          errorDiv.classList.add('hidden');
        }, 5000);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
      }
    });

    // Pre-select topic based on URL param
    const urlParams = new URLSearchParams(window.location.search);
    const topic = urlParams.get('topic');
    const plan = urlParams.get('plan') || urlParams.get('tier');

    if (topic) {
      const topicSelect = document.getElementById('topic');
      // Check if the topic value is valid
      const validTopics = ['general', 'support', 'verification', 'security', 'sales', 'enterprise', 'partnership', 'feedback', 'bug', 'other'];
      if (validTopics.includes(topic)) {
        topicSelect.value = topic;
      }
    } else if (plan === 'enterprise') {
      document.getElementById('topic').value = 'enterprise';
    }
  </script>
</BaseLayout>
