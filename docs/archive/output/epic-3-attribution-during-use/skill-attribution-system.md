# Skill Attribution System Design
**Epic 3: Attribution During Use - Making Value Visible**
**Priority**: HIGH
**Behavioral Designer**: Phase 4 Product Strategy

## Executive Summary

Design a subtle yet effective attribution system that makes skill-generated outputs visible to users without cluttering their workspace. The system must respect privacy while enabling users to track which skills deliver value.

---

## 1. Attribution Design Principles

### Core Tenets
1. **Visible But Not Intrusive**: Attribution present but not distracting
2. **User-Controlled**: Users can toggle attribution on/off per mode
3. **Privacy-First**: No external tracking, all data stays local
4. **Context-Appropriate**: Different attribution for different contexts
5. **Value-Emphasizing**: Attribution highlights benefits, not just "skill X did this"

### Anti-Patterns to Avoid
- ❌ Watermarks in generated code (unprofessional)
- ❌ Forced attribution that can't be disabled
- ❌ Attribution that breaks code functionality
- ❌ Tracking user behavior for monetization
- ❌ Overwhelming users with attribution on every action

---

## 2. Attribution Modes

### Mode 1: Inline Comment Attribution (Code Generation)
**Use Case**: Skills that generate code files
**Implementation**: Comments at top of generated files

```typescript
/**
 * Generated by Skillsmith - jest-helper skill
 * Created: 2025-12-31 14:30:42
 *
 * This test file covers:
 * - Component rendering (3 tests)
 * - Props validation (2 tests)
 * - Event handlers (2 tests)
 *
 * Modify as needed for your use case.
 */

import { render, screen } from '@testing-library/react';
import { Button } from './Button';

describe('Button', () => {
  test('renders with correct text', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });
});
```

**Characteristics**:
- **Non-invasive**: Standard comment format, doesn't affect code
- **Removable**: Users can delete comment without breaking functionality
- **Informative**: Shows WHAT was generated (summary)
- **Timestamped**: Useful for tracking when skill was used
- **Language-Appropriate**: Uses proper comment syntax (JSDoc, #, //, etc.)

---

### Mode 2: Metadata Attribution (Non-Code Files)
**Use Case**: Configuration files, Markdown, YAML, JSON
**Implementation**: Metadata fields or comments

#### Example: docker-compose.yml
```yaml
# Generated by Skillsmith - docker-compose skill
# Created: 2025-12-31 14:30:42
# Includes: Node.js app, PostgreSQL, Redis, Nginx

version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@db:5432/myapp
```

#### Example: README.md
```markdown
<!-- Generated by Skillsmith - api-docs skill -->
<!-- Created: 2025-12-31 14:30:42 -->

# API Documentation

## Authentication Endpoints

### POST /auth/login
[Content...]
```

#### Example: package.json
```json
{
  "name": "my-app",
  "version": "1.0.0",
  "_skillsmith": {
    "generated_by": "eslint-config",
    "created_at": "2025-12-31T14:30:42Z",
    "fields_added": ["scripts.lint", "devDependencies.eslint"]
  },
  "scripts": {
    "lint": "eslint . --ext .ts,.tsx"
  },
  "devDependencies": {
    "eslint": "^8.50.0"
  }
}
```

---

### Mode 3: Session History Attribution (Chat UI)
**Use Case**: Claude Desktop/Web chat interface
**Implementation**: Inline attribution in Claude's response

```
┌────────────────────────────────────────────────┐
│ CLAUDE:                                        │
│                                                │
│ I've generated a comprehensive test suite     │
│ for your Button component:                    │
│                                                │
│ [Code block shown...]                         │
│                                                │
│ ──────────────────────────────────────────    │
│ ⚙️ Generated by jest-helper skill             │
│ • 5 test cases                                 │
│ • 100% component coverage                     │
│ • Runtime: 2.3 seconds                         │
│ ──────────────────────────────────────────    │
│                                                │
│ [Copy Code] [Save to File] [Modify Tests]     │
└────────────────────────────────────────────────┘
```

**Characteristics**:
- **Contextual**: Shows within Claude's response
- **Summarized**: Key metrics at a glance
- **Actionable**: Buttons for next steps
- **Optional**: Can be hidden in settings

---

### Mode 4: Status Bar Attribution (IDE/Editor)
**Use Case**: VS Code, JetBrains IDEs
**Implementation**: Skill indicator in status bar

```
Status Bar (Bottom Right):
─────────────────────────────────────────────────────
[Git: main] [TypeScript ✓] [Skillsmith: jest-helper ⚙️]
                            ↑
                            Click to see details
```

**On Click**:
```
╔═══════════════════════════════════════════════╗
║ Active Skills This Session                    ║
╠═══════════════════════════════════════════════╣
║ jest-helper                                   ║
║ • Generated Button.test.tsx (14:30)           ║
║ • Generated LoginForm.test.tsx (14:35)        ║
║                                               ║
║ react-component                               ║
║ • Generated SignupForm.tsx (14:42)            ║
║                                               ║
║ commit                                        ║
║ • Created 2 commit messages (14:50, 15:10)    ║
║                                               ║
║ [View Full History] [Export Report]           ║
╚═══════════════════════════════════════════════╝
```

---

### Mode 5: File Metadata Attribution (Hidden)
**Use Case**: Track attribution without visible markers
**Implementation**: Extended file attributes (macOS/Linux) or NTFS streams (Windows)

```bash
# macOS/Linux: Extended attributes
xattr -w com.skillsmith.generated_by "jest-helper" Button.test.tsx
xattr -w com.skillsmith.created_at "2025-12-31T14:30:42Z" Button.test.tsx

# Read later
xattr -p com.skillsmith.generated_by Button.test.tsx
# Output: jest-helper
```

**Advantages**:
- **Invisible**: Doesn't modify file content
- **Persistent**: Survives file edits
- **Queryable**: Can search for all files by a specific skill
- **Privacy-Preserving**: Only accessible locally

**Disadvantages**:
- **Not Portable**: Lost when copying files via some methods
- **Platform-Specific**: Requires OS support

---

## 3. Attribution User Settings

### Settings Panel
```
┌─────────────────────────────────────────────┐
│ Skill Attribution Settings                  │
├─────────────────────────────────────────────┤
│                                             │
│ Enable Attribution:  [✓] On                │
│                                             │
│ Attribution Modes:                          │
│ [✓] Inline comments in generated code      │
│ [✓] Metadata in config files               │
│ [✓] Session history in chat                │
│ [✓] Status bar indicator (IDE only)        │
│ [ ] File metadata (hidden attributes)      │
│                                             │
│ Comment Format:                             │
│ [Simple ▼]                                  │
│ • Simple: "Generated by Skillsmith"        │
│ • Detailed: Includes timestamp & summary   │
│ • Custom: ____________________________     │
│                                             │
│ Privacy:                                    │
│ [✓] Keep all attribution local             │
│ [ ] Allow anonymous usage telemetry        │
│                                             │
│ [Remove All Attribution] [Reset Defaults]  │
└─────────────────────────────────────────────┘
```

### Per-Skill Override
```
┌─────────────────────────────────────────────┐
│ jest-helper Skill Settings                  │
├─────────────────────────────────────────────┤
│                                             │
│ Attribution:                                │
│ • Use global settings                       │
│ ○ Always include attribution               │
│ ○ Never include attribution                │
│                                             │
│ Custom Attribution Template:                │
│ ┌─────────────────────────────────────────┐ │
│ │ /**                                     │ │
│ │  * Test suite generated by jest-helper  │ │
│ │  * Coverage: {{coverage}}%              │ │
│ │  * Test cases: {{test_count}}           │ │
│ │  */                                     │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ Available Variables:                        │
│ • {{skill_name}}                            │
│ • {{timestamp}}                             │
│ • {{coverage}} (skill-specific)             │
│ • {{test_count}} (skill-specific)           │
│                                             │
│ [Save] [Cancel]                             │
└─────────────────────────────────────────────┘
```

---

## 4. Attribution Data Schema

### Local SQLite Database
```sql
CREATE TABLE skill_attributions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  session_id TEXT NOT NULL,
  skill_id TEXT NOT NULL,
  skill_name TEXT NOT NULL,

  -- Output information
  output_type TEXT NOT NULL, -- 'file' | 'text' | 'action'
  file_path TEXT,             -- If file generated
  file_size INTEGER,          -- Bytes
  line_count INTEGER,         -- For code files

  -- Metrics
  generation_time_ms INTEGER,
  estimated_time_saved_minutes INTEGER,
  quality_score INTEGER,      -- 0-100, if applicable

  -- Timestamps
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

  -- User feedback (optional)
  user_rating INTEGER,        -- 1-5, if user provides
  user_modified BOOLEAN DEFAULT FALSE,
  user_deleted BOOLEAN DEFAULT FALSE,

  -- Metadata (JSON)
  metadata TEXT               -- Skill-specific data
);

CREATE INDEX idx_attribution_session ON skill_attributions(session_id);
CREATE INDEX idx_attribution_skill ON skill_attributions(skill_id);
CREATE INDEX idx_attribution_date ON skill_attributions(created_at);

-- Example query: All files generated by jest-helper this week
SELECT file_path, created_at, line_count
FROM skill_attributions
WHERE skill_id = 'jest-helper'
  AND output_type = 'file'
  AND created_at >= date('now', '-7 days')
ORDER BY created_at DESC;
```

### Privacy Guarantees
1. **Local Only**: Database stored in `~/.skillsmith/attributions.db`
2. **No Cloud Sync**: Never uploaded to external servers
3. **User Exportable**: Users can export/delete all data anytime
4. **Opt-In Telemetry**: Anonymous aggregates only if explicitly enabled

---

## 5. Attribution Display Formats

### Code Comment Templates

#### TypeScript/JavaScript
```typescript
/**
 * Generated by Skillsmith - {{skill_name}}
 * Created: {{timestamp}}
 * {{#if summary}}
 * {{summary}}
 * {{/if}}
 */
```

#### Python
```python
# Generated by Skillsmith - {{skill_name}}
# Created: {{timestamp}}
# {{summary}}
```

#### YAML
```yaml
# Generated by Skillsmith - {{skill_name}}
# Created: {{timestamp}}
```

#### HTML
```html
<!-- Generated by Skillsmith - {{skill_name}} -->
<!-- Created: {{timestamp}} -->
```

### Rich Attribution (Detailed Mode)
```typescript
/**
 * ╔═══════════════════════════════════════════════════════╗
 * ║  Generated by Skillsmith                              ║
 * ╠═══════════════════════════════════════════════════════╣
 * ║  Skill: jest-helper                                   ║
 * ║  Created: 2025-12-31 14:30:42                         ║
 * ║                                                       ║
 * ║  Test Coverage:                                       ║
 * ║  • Component rendering: 3 tests                       ║
 * ║  • Props validation: 2 tests                          ║
 * ║  • Event handlers: 2 tests                            ║
 * ║  • Coverage: 100% statements, 100% branches           ║
 * ║                                                       ║
 * ║  Modify this file as needed. Regenerate with:         ║
 * ║  "Update tests for Button.tsx"                        ║
 * ╚═══════════════════════════════════════════════════════╝
 */
```

**Use Case**: First-time users who want detailed explanations

---

## 6. Privacy Considerations

### Data Collection Policy
```
Skillsmith Attribution Privacy Policy

WHAT WE TRACK (Locally):
✓ Which skills you use
✓ Files generated by skills
✓ Time saved estimates
✓ Your satisfaction ratings (if provided)

STORED LOCALLY:
✓ All attribution data in ~/.skillsmith/attributions.db
✓ Never uploaded to cloud
✓ No account registration required

YOU CONTROL:
✓ Enable/disable attribution anytime
✓ Remove attribution from files
✓ Export or delete all data
✓ Opt-in for anonymous telemetry (aggregates only)

WE NEVER:
✗ Track your code content
✗ Send your files to external servers
✗ Share your data with third parties
✗ Use your data for advertising
```

### Opt-In Telemetry
If user enables anonymous telemetry:
```typescript
interface AnonymousTelemetry {
  // Aggregates only, no PII
  skill_id: string;
  usage_count: number;
  avg_generation_time_ms: number;
  avg_file_size: number;
  user_rating_avg: number; // If ratings provided

  // NO user identification
  // NO file paths
  // NO code content
  // NO timestamps
}
```

**Opt-In Flow**:
```
┌─────────────────────────────────────────────┐
│ Help Improve Skillsmith?                    │
├─────────────────────────────────────────────┤
│ Share anonymous usage statistics to help    │
│ us improve skill quality.                   │
│                                             │
│ We'll collect:                              │
│ ✓ Which skills are most useful             │
│ ✓ Average generation time                  │
│ ✓ User satisfaction ratings                │
│                                             │
│ We'll NEVER collect:                        │
│ ✗ Your code or file paths                  │
│ ✗ Personal information                     │
│ ✗ Identifiable data                        │
│                                             │
│ [Enable Telemetry] [No Thanks]             │
│ [Learn More]                                │
└─────────────────────────────────────────────┘
```

---

## 7. User Toggle Mechanism

### Quick Toggle (Keyboard Shortcut)
- **Global**: `Ctrl+Shift+A` - Toggle attribution on/off
- **Per-File**: Right-click file → "Remove Skillsmith Attribution"
- **Per-Session**: Status bar icon → "Hide Skill Indicators This Session"

### Bulk Attribution Removal
```bash
# CLI command to remove attribution from all files
skillsmith attribution remove --directory ./src --recursive

# Interactive mode
skillsmith attribution remove --interactive

Output:
┌─────────────────────────────────────────────┐
│ Remove Attribution                          │
├─────────────────────────────────────────────┤
│ Found 23 files with Skillsmith attribution: │
│                                             │
│ [✓] Button.test.tsx (jest-helper)           │
│ [✓] LoginForm.tsx (react-component)         │
│ [✓] docker-compose.yml (docker-compose)     │
│ ... (20 more)                               │
│                                             │
│ [Remove from Selected] [Remove from All]    │
│ [Cancel]                                    │
└─────────────────────────────────────────────┘
```

### Granular Control
```
Attribution for: Button.test.tsx
┌─────────────────────────────────────────────┐
│ Current Attribution:                        │
│ • Inline comment: ✓ Enabled                │
│ • File metadata: ✓ Enabled                 │
│                                             │
│ [Remove Inline Comment Only]                │
│ [Remove All Attribution]                    │
│ [Keep As-Is]                                │
└─────────────────────────────────────────────┘
```

---

## 8. Skill-Specific Attribution Features

### jest-helper: Test Coverage Attribution
```typescript
/**
 * Generated by Skillsmith - jest-helper
 * Test Coverage: 100% statements, 95% branches, 100% functions
 * Test Count: 7 (3 rendering, 2 props, 2 events)
 * Runtime: 2.3 seconds
 */
```

### commit: Commit History Attribution
```bash
git log --format=fuller

commit a3f7c2b...
Author:     John Doe <john@example.com>
AuthorDate: Wed Dec 31 14:30:42 2025 -0800
Commit:     Skillsmith Commit Skill <noreply@skillsmith.dev>
CommitDate: Wed Dec 31 14:30:42 2025 -0800

    feat(auth): add OAuth2 login flow

    Generated by Skillsmith commit skill
    Analyzed 4 files (127 additions, 23 deletions)
```

### docker-compose: Service Inventory Attribution
```yaml
# Generated by Skillsmith - docker-compose skill
# Services: app (Node.js 20), db (PostgreSQL 15), cache (Redis 7), proxy (Nginx)
# Includes: Multi-stage builds, health checks, volume persistence
```

---

## 9. Attribution Analytics Dashboard

### User-Facing Analytics
```
┌──────────────────────────────────────────────────┐
│ Your Skillsmith Usage (Last 30 Days)            │
├──────────────────────────────────────────────────┤
│                                                  │
│ Most Used Skills:                                │
│ 1. jest-helper       23 uses, 38 files generated│
│ 2. commit            19 uses, 19 commits created │
│ 3. react-component   12 uses, 12 components made│
│                                                  │
│ Time Saved: ~8.5 hours                           │
│                                                  │
│ Files Generated: 73                              │
│ • Tests: 38 files                                │
│ • Components: 12 files                           │
│ • Config: 15 files                               │
│ • Docs: 8 files                                  │
│                                                  │
│ Quality Scores:                                  │
│ • Avg. user rating: 4.6/5.0 ⭐                   │
│ • Files kept unchanged: 68% (50/73)              │
│ • Files deleted: 4% (3/73)                       │
│                                                  │
│ [View Detailed Report] [Export CSV]              │
└──────────────────────────────────────────────────┘
```

### Per-Skill Analytics
```
jest-helper Analytics (Last 30 Days)
┌──────────────────────────────────────────────────┐
│ Usage: 23 times                                  │
│ Files Generated: 38 test files                   │
│ Total LOC: 2,847 lines of test code              │
│ Time Saved: ~4.7 hours (estimated)               │
│                                                  │
│ Test Coverage Achieved:                          │
│ • 100% coverage: 28 files (74%)                  │
│ • 90-99% coverage: 8 files (21%)                 │
│ • <90% coverage: 2 files (5%)                    │
│                                                  │
│ User Satisfaction: 4.8/5.0 ⭐                    │
│                                                  │
│ Most Common Test Types:                          │
│ • Component rendering: 89 tests                  │
│ • Props validation: 45 tests                     │
│ • Event handlers: 38 tests                       │
│                                                  │
│ [View Files] [Generate Report]                   │
└──────────────────────────────────────────────────┘
```

---

## 10. Integration Points

### Integration with SkillRepository
```typescript
class AttributionService {
  async recordAttribution(
    skillId: string,
    output: SkillOutput,
    options: AttributionOptions
  ): Promise<void> {

    // Store in database
    await this.db.insert('skill_attributions', {
      session_id: this.sessionId,
      skill_id: skillId,
      skill_name: output.skillName,
      output_type: output.type,
      file_path: output.filePath,
      file_size: output.fileSize,
      line_count: output.lineCount,
      generation_time_ms: output.generationTime,
      estimated_time_saved_minutes: this.estimateTimeSaved(output),
      created_at: new Date()
    });

    // Add inline attribution if enabled
    if (options.inlineAttribution && output.type === 'file') {
      await this.addInlineAttribution(output.filePath, skillId, output);
    }

    // Add file metadata if enabled
    if (options.fileMetadata && output.type === 'file') {
      await this.addFileMetadata(output.filePath, skillId);
    }

    // Update session history
    await this.updateSessionHistory(skillId, output);
  }

  private async addInlineAttribution(
    filePath: string,
    skillId: string,
    output: SkillOutput
  ): Promise<void> {
    const settings = await this.getAttributionSettings();
    const template = settings.commentFormat;

    const comment = this.renderTemplate(template, {
      skill_name: output.skillName,
      timestamp: new Date().toISOString(),
      summary: output.summary
    });

    await this.prependCommentToFile(filePath, comment);
  }
}
```

### Integration with File Operations
```typescript
// When writing generated files
async function writeGeneratedFile(
  path: string,
  content: string,
  skill: Skill,
  attribution: boolean
): Promise<void> {

  let finalContent = content;

  if (attribution) {
    const comment = generateAttributionComment(skill, content);
    finalContent = `${comment}\n\n${content}`;
  }

  await fs.writeFile(path, finalContent);

  // Record attribution
  await attributionService.recordAttribution(skill.id, {
    type: 'file',
    filePath: path,
    fileSize: Buffer.byteLength(finalContent),
    lineCount: finalContent.split('\n').length,
    skillName: skill.name
  });
}
```

---

## 11. Success Metrics

### Primary KPIs

| Metric | Target | Measurement |
|--------|--------|-------------|
| **Attribution Awareness** | ≥80% | % users who notice attribution |
| **Attribution Retention** | ≥70% | % users who keep attribution enabled |
| **Perceived Intrusiveness** | ≤2.0/5.0 | User survey (lower is better) |
| **Privacy Trust Score** | ≥4.5/5.0 | "I trust Skillsmith with my data" |

### Secondary KPIs

| Metric | Target | Measurement |
|--------|--------|-------------|
| **Custom Template Usage** | ≥15% | % users who customize attribution |
| **Bulk Removal Usage** | ≤10% | % users who remove all attribution |
| **Analytics Dashboard Views** | ≥40% | % users who view dashboard monthly |
| **Telemetry Opt-In Rate** | ≥25% | % users who enable telemetry |

---

## 12. Accessibility Requirements

### Screen Reader Announcements
- Attribution comments read as normal code comments
- Status bar attribution: "Skillsmith: jest-helper active"
- Dashboard navigation: Proper heading hierarchy (h1, h2, h3)

### Keyboard Navigation
- `Alt+A`: Toggle attribution on/off
- `Alt+Shift+A`: View attribution for current file
- `Tab` navigation through analytics dashboard

### High Contrast Mode
- Attribution comments use distinct color (#0078d4 in VSCode)
- Status bar icon high contrast variant

---

## 13. User Testing Protocol

### Phase 1: Attribution Noticeability (Week 1)
**Participants**: 25 users installing skills
**Method**: Observe if users notice attribution

**Tasks**:
1. Generate a file with jest-helper
2. Open the generated file
3. (Ask after 30 seconds) "Did you notice anything special about this file?"

**Metrics**:
- % who notice attribution spontaneously
- % who can explain what it means
- Sentiment (positive/neutral/negative)

**Success Criteria**:
- ≥70% notice attribution
- ≥90% positive or neutral sentiment

---

### Phase 2: Privacy Perception (Weeks 2-3)
**Participants**: 30 users
**Method**: Survey + interviews

**Questions**:
1. "Do you feel comfortable with how Skillsmith tracks your usage?" (1-5)
2. "What concerns, if any, do you have about attribution data?"
3. "Would you enable anonymous telemetry?" (Yes/No/Maybe)

**Success Criteria**:
- ≥4.5/5.0 comfort level
- ≥25% telemetry opt-in

---

### Phase 3: Customization Testing (Week 4)
**Participants**: 20 users
**Method**: Feature discovery + usability

**Tasks**:
1. Find attribution settings
2. Change comment format
3. Remove attribution from a file

**Metrics**:
- % who find settings without help
- Time to customize
- % who successfully customize

**Success Criteria**:
- ≥80% find settings in <2 minutes
- 100% successfully customize

---

**Document Version**: 1.0
**Last Updated**: December 31, 2025
**Author**: Behavioral Designer, Phase 4 Team
**Review Status**: Ready for Technical Review
