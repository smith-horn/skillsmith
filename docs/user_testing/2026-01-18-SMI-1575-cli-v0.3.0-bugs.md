# User Testing Report: CLI v0.3.0 Bug Discovery

**Date**: January 18, 2026
**Tester**: Charles (Product Manager)
**Test Environment**: Fresh macOS installation
**Project Tested**: giskard repository (Python/ML project)
**Linear Issue**: SMI-1575

---

## Executive Summary

User testing revealed that CLI v0.3.0 is **non-functional for new users**. Four critical bugs were discovered that prevent basic CLI operations. All issues stem from assumptions about existing state (databases, API responses) that don't hold for new installations or edge cases.

| # | Severity | Command | Error | Root Cause |
|---|----------|---------|-------|------------|
| 1 | Critical | `sync` | SQLITE_ERROR: no such table: skills | Uses `openDatabase()` instead of `createDatabase()` |
| 2 | High | `recommend` | Zod validation failed | API returns optional fields as undefined |
| 3 | Medium | `import` | Silent GitHub API failures | Insufficient rate limiting, no verbose logging |
| 4 | Low | `analyze` | Missing Python files | `SUPPORTED_EXTENSIONS` lacks `.py` |

---

## Session Details

### Environment

- **OS**: macOS Ventura 14.2
- **Node.js**: 20.11.0
- **CLI Version**: @skillsmith/cli@0.3.0
- **Installation Method**: `npx @skillsmith/cli`
- **Test Project**: https://github.com/Giskard-AI/giskard (Python ML testing framework)

### User Profile

- **Role**: Product Manager
- **Technical Level**: Intermediate (comfortable with CLI, not a developer)
- **Goal**: Evaluate Skillsmith for team adoption

---

## Bug 1: Sync Command Database Error (Critical)

### Command Attempted

```bash
npx @skillsmith/cli sync
```

### Error Output

```
⠋ Opening database...
Error: SQLITE_ERROR: no such table: skills
    at Database.prepare (/Users/charles/.npm/_npx/xxx/node_modules/better-sqlite3/lib/database.js:241:15)
    at SkillRepository.findAll (/Users/charles/.npm/_npx/xxx/node_modules/@skillsmith/core/dist/repositories/SkillRepository.js:45:30)
    ...
```

### Root Cause Analysis

The `sync.ts` command imports `openDatabase()` which only opens an existing database file. On fresh installations, `~/.skillsmith/skills.db` doesn't exist, so when the code tries to query tables, they don't exist.

**Code Location**: `packages/cli/src/commands/sync.ts:21`

```typescript
// Current (broken)
import { openDatabase, ... } from '@skillsmith/core'
const db = openDatabase(options.dbPath)  // Line 47

// Should be
import { createDatabase, ... } from '@skillsmith/core'
const db = createDatabase(options.dbPath)  // Creates tables if missing
```

### Impact

- **Severity**: Critical
- **Affected Users**: 100% of new users
- **Workaround**: None (users cannot use CLI without manual database creation)

---

## Bug 2: Recommend Command Zod Validation (High)

### Command Attempted

```bash
npx @skillsmith/cli recommend
```

### Error Output

```
Error: Invalid API response: data.0.repo_url: Expected string, received undefined, data.0.created_at: Required
    at SkillsmithApiClient.request (/Users/charles/.npm/_npx/xxx/node_modules/@skillsmith/core/dist/api/client.js:152:19)
    ...
```

### Root Cause Analysis

The `ApiSearchResultSchema` in `client.ts` expects all fields to be present, but the API returns partial responses where optional fields are undefined rather than null.

**Code Location**: `packages/core/src/api/client.ts:31-44`

```typescript
// Current (too strict)
const ApiSearchResultSchema = z.object({
  repo_url: z.string().nullable(),      // Fails on undefined
  created_at: z.string(),               // Fails on undefined
  updated_at: z.string(),               // Fails on undefined
  trust_tier: TrustTierSchema,          // Fails on undefined
  tags: z.array(z.string()),            // Fails on undefined
  ...
})

// Should be (with defaults)
const ApiSearchResultSchema = z.object({
  repo_url: z.string().nullable().optional(),
  created_at: z.string().optional(),
  updated_at: z.string().optional(),
  trust_tier: TrustTierSchema.default('unknown'),
  tags: z.array(z.string()).default([]),
  ...
})
```

### Impact

- **Severity**: High
- **Affected Users**: Users querying skills with incomplete metadata
- **Workaround**: None (command fails entirely)

---

## Bug 3: Import Silent Failures (Medium)

### Command Attempted

```bash
npx @skillsmith/cli import --topic claude-skill
```

### Observed Behavior

```
Searching for repositories with topic: claude-skill...
Found 150/523 repositories...
Found 300/523 repositories...
Request failed, retrying in 1000ms...
Request failed, retrying in 2000ms...
Request failed, retrying in 4000ms...

--- Import Complete ---
Imported: 287
Skipped: 0
Errors: 236
Duration: 847.2s
```

### Root Cause Analysis

1. **Insufficient delay**: The 100ms delay between API calls (line 296) triggers GitHub's secondary rate limits
2. **Silent failures**: SKILL.md fetch failures (line 129-131) are swallowed without logging
3. **Poor statistics**: The summary shows "Errors: 236" but doesn't explain what failed

**Code Location**: `packages/cli/src/import.ts`

```typescript
// Line 296: Too short
await sleep(100)

// Lines 129-131: Silent catch
} catch {
  return null  // No logging, failure is invisible
}
```

### Impact

- **Severity**: Medium
- **Affected Users**: Users running large imports
- **Workaround**: Set `GITHUB_TOKEN` and retry (partial mitigation)

---

## Bug 4: Analyze Missing Python Files (Low)

### Command Attempted

```bash
npx @skillsmith/cli analyze ~/projects/giskard
```

### Observed Behavior

```
Analyzing codebase at /Users/charles/projects/giskard...

=== Codebase Analysis ===

Files analyzed: 23
Languages detected: JavaScript

Frameworks detected:
  • None detected

Dependencies:
  • None found
```

### Expected Behavior

The giskard repository is primarily Python with 500+ `.py` files. The analyzer should detect Python and identify Flask/pytest frameworks.

### Root Cause Analysis

The `SUPPORTED_EXTENSIONS` constant only includes JavaScript/TypeScript extensions. While `LANGUAGE_EXTENSIONS` defines Python support, the legacy constant is still used by some code paths.

**Code Location**: `packages/core/src/analysis/types.ts:21`

```typescript
// Current (missing Python)
export const SUPPORTED_EXTENSIONS = ['.ts', '.tsx', '.js', '.jsx', '.mjs', '.cjs']

// Should be
export const SUPPORTED_EXTENSIONS = ['.ts', '.tsx', '.js', '.jsx', '.mjs', '.cjs', '.py', '.pyi']
```

### Impact

- **Severity**: Low
- **Affected Users**: Python developers
- **Workaround**: Use `--languages python` flag (if implemented)

---

## Recommendations

### Immediate Actions (v0.3.1 Hotfix)

1. **SMI-1576**: Fix sync database initialization (Critical)
2. **SMI-1577**: Fix Zod schema validation (High)
3. **SMI-1578**: Improve import resilience (Medium)
4. **SMI-1579**: Add Python detection (Low)

### Process Improvements

1. **Fresh Install Testing**: Add CI step that tests CLI on clean environment
2. **API Contract Testing**: Mock API responses with missing optional fields
3. **User Session Recording**: Capture real user sessions for QA review
4. **Error Message Quality**: Include actionable remediation steps in errors

---

## Attachments

- Screenshot: sync_error.png (Terminal showing database error)
- Screenshot: recommend_error.png (Zod validation failure)
- Log file: import_verbose.log (Full import session with errors)
- Video: analyze_session.mp4 (10-minute recording of testing session)

---

## Sign-off

| Role | Name | Date |
|------|------|------|
| Tester | Charles | January 18, 2026 |
| QA Lead | Pending | - |
| Dev Lead | Pending | - |
